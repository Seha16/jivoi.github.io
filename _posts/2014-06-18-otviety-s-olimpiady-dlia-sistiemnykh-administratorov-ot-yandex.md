---
layout: post
title: "Ответы с олимпиады для системных администраторов от Yandex"
modified: 2014-06-18 16:39:24 +0300
category: [howto]
tags: [linux, sysadm, yandex]
image:
  feature:
  credit:
  creditlink:
comments: True
share:
---
Ответы с олимпиады для системных администраторов от Yandex.
Много интересных вопросов.

## Ответы на вопросы первой игры первого тура:

### Вопрос 1.
С помощью каких комбинаций клавиш в текстовых редакторах vi или vim скопировать в буфер 4 строки, начиная со строки, где находится курсор?

### Ответ:  
Способов много,  навскидку можно ответить, что это можно сделать с помощью:  4yy, либо y4y, либо 4ddkp, либо v курсор y, либо 4+Shift+y

### Вопрос  2.
Вы в bash запустили команду echo $[5/2]. Какой будет результат?

### Ответ:  
ну тут все просто, ответ  2

### Вопрос 3.
В bash вы хотите сравнить два числа.  Какой оператор сравнения нужно применить, если нужно узнать,  что первое значение больше или равно второму?

### Ответ:   
Обычно применяют  -ge

### Вопрос 4.
Вам нужно запустить web-сервер Apache на порту 3128. С помощью  какой директивы в конфигурационном файле это можно сделать?

### Ответ:  
Listen  или Port

### Вопрос 5.
Как в Linux узнать текущий рабочий каталог процесса с pid = 4556?

### Ответ:  
Его можно найти в файлике /proc/4556/cwd   

### Вопрос 6.
Как в Unix посмотреть какие файлы или устройства  использует процесс с pid = 85003?  
Вообще этот вопрос вызвал много споров.

### Ответ:
Мы принимали следующие ответы:
Для Linux: никак или в ответе должно было быть упоминание, что это можно сделать с помощью дополнительной настройки ядра, например, sysctl -w kernel.pid_max = (число > 85003). По умолчанию значение переменной kernel.pid_max = 32768;
Для FreeBSD: fstat -p 85003 или установить lsof, а потом посмотреть с помощью lsof -p 85003. Утилиты lsof и procfs по умолчанию не установлены;
Для Solaris мы принимали ответ, что можно сделать с помощью утилиты pfiles.

### Вопрос 7.
Какие из перечисленных типов хранилищ в MySQL  поддерживают транзакционность:  MyISAM, Memory, InnoDB, Archive, NDB, CSV? 

### Ответ:  
Ну тут, конечно, все вспомнили InnoDB, но и NDB тоже поддерживает транзакции.

### Вопрос 8.
Как в PostgreSQL очистить файлы баз данных от уже удалённых записей?

### Ответ:   
Вот уже много лет,  любимой командой администраторов PostgreSQL  является VACUUM FULL. 

### Вопрос 9.
Как очистить лог-файл /var/log/log, открытый  работающим процессом?

### Ответ:  
Тут как и в пером вопросе тоже сразу можно привести массу вариантов:  $echo –n > /var/log/log  или $ > /var/log/log или $ cat /dev/null > /var/log/log .   

### Вопрос 10.
Вы зашли на сервер с Linux с помощью ssh. Как перегрузить этот сервер по sysrq-b?

### Ответ:  
вот такой командой - $ echo b > /proc/sysrq-trigger   

### Вопрос 11.
Как подсчитать количество строк в текстовом файле file.txt?

### Ответ:   
Ну тут тоже самый привычный и распространенный сценарий у васех администраторов - $wc -l file.txt  .

### Вопрос 12.
Как найти подстроку  в файле, сжатом с помощью gzip?

### Ответ:   
Тоже вот прям сходу пара вариантов:  $zgrep  stroka  file или $zcat  file | grep stroka 

### Вопрос 13.
Какой утилитой в Linux можно проверить состояние и включить/выключить кеширование на запись для SAS/SATA устройства (диска)?

### Ответ:   
hdparm в случае SATA или  sdparm  в случае SAS/SATA. 

### Вопрос 14.
Как посмотреть версию и возможные параметры модуля e1000e для загруженного в настоящий момент ядра в Linux?

### Ответ:  
modinfo e1000e   

### Вопрос 15.
Как в командной строке bash повторить команду, которую вы набирали ранее?

### Ответ:  
Тоже навскидку 3 варианта: Ctrl+r или !- или курсорные клавиши   

### Вопрос 16.
Какой командой в Linux можно разрешить dump corefile-ов в текущей сессии без ограничения по размеру?

### Ответ:  
ulimit -c unlimited   

### Вопрос 17.
Как записать 100 пакетов на интерфейсе eth0 в файл mytrace.raw, не ограничивая длину захваченного (captured) пакета?

### Ответ:  
tcpdump -i eth0 -c 100 -s 0 -w mytrace.raw   

### Вопрос 18.
Как изменить процент зарезервированного для root-а места на файловой системе ext3 до 2%, смонтированной в /filesystem в Linux?

### Ответ:   
tune2fs -m2 /filesystem   

### Вопрос 19.
Как в Linux смонтировать файловую систему tmpfs размеров 2Гб в /tmpfs?

### Ответ:   
mount none /tmpfs -t tmpfs -o size=2g  

### Вопрос 20.
Как посмотреть таблицы NAT в «файрволе» на сервере с Linux (ядро 2.6.X)?

### Ответ:
iptables -L -t nat   

### Вопрос 21.
Какой утилитой в Linux можно посмотреть, какие системные вызовы делает работающий процесс?

### Ответ:
Любимой утилитой всех системных администраторов - strace   

### Вопрос 22.
Как посмотреть процессы пользователя vasya, отсортировав их по resident size в порядке убывания?

### Ответ:
Вообще вариантов ответа очень много, но вот, например один из них: ps nu -U vasya --sort -rss   

### Вопрос 23.
Как смонтировать каталог /var/log/mydaemon в /mydaemon?

### Ответ:
mount /var/log/mydaemon /mydaemon -o bind   

### Вопрос 24.
Какое максимальное число адресов можно использовать в ipv4 сети /26?

### Ответ:
Ответ 62, потому что 2 адреса из 64: Широковещательный адрес и Адрес сети – являются служебными.

### Вопрос 25.
Как затереть нулями первые 64Мб диска /dev/sda?

### Ответ:
dd if=/dev/zero of=/dev/sda bs=64M count=1 или dd if=/dev/zero of=/dev/sda bs=1M count=64

### Вопрос 26.
Какова последовательность пакетов tcp при установке соединения (укажите типы пакетов)?
 
### Ответ: 
хост A посылает хосту B пакет с установленным битом SYN и 32-битным значением ISSa в поле Sequence Number
хост B отвечает хосту A пакетом с установленными битами SYN и ACK, 32-битным значением ISSb в поле Sequence Number, и значением (ISSa+1) в поле ACK
хост A отвечает хосту B пакетом с установленным битом ACK, значением (ISSa+1) в поле Sequence Number, и значением (ISSb+1) в поле ACK.

### Вопрос 27.
Какой параметр ядра отвечает за максимальный размер памяти, доступный для выделения процессам в Linux? 

### Ответ:
vm.overcommit_ratio   

### Вопрос 28.
Как в Linux сделать так, чтобы core-файлы сохранялись c именем /var/tmp/core.{pid}? 

### Ответ:
sysctl -w kernel.core_pattern="/var/tmp/core.%p"   

### Вопрос 29.
Как одной командой «сбросить» все переменные окружения (сделать «пустое» окружение) в текущей сессии в Linux?

### Ответ:  
env -i     

### Вопрос 30.
Как включить jumbo-frames на сетевом интерфейсе eth0?

### Ответ:
ifconfig eth0 mtu 9000

## Ответы на вопросы второй игры первого тура:

### Вопрос 1.
Напишите чему будет равен mss, если Вы используете IPv6 и mtu=1450?

### Ответ:  
1390, при использовании TCP поверх IPv6, MSS должно быть вычислено как максимальная длина пакета минус 60 октетов, так как минимальная длина заголовка IPv6 (т.e., IPv6 заголовок без заголовков расширения) на 20 октетов больше, чем для IPv4.

### Вопрос 2.
Что в bash напечатает команда echo $((5/2))?

### Ответ: 
Как ни странно, но ответ такой же, как и в первой игре – 2 

### Вопрос 3. 
Приведите пример команды, которая напечатает 'Y' , если файл/var/tmp/core существует и он ненулевого размера (используя средства bash и coreutils)?

### Ответ: 
Например, можно сделать это  вот таким способом  $test -s /var/tmp/core && echo 'Y' или вот таким $ [ -s /var/tmp/core ] && echo 'Y'

### Вопрос 4. 
С помощью какой директивы в Apache 1.3 можно указать e-mail для связи на стандартной страничке Internal Server Error?

### Ответ:   
ServerAdmin

### Вопрос 5. 
Как в Linux вывести все переменные окружения, с которыми работает процесс с pid = 5671, в виде списка, где каждая переменная на отдельной строке?

### Ответ:   
На этот  вопрос в шаблоне для проверки забито очень много разных вариантов,  вот парочка из них:  $/proc/5671/environ | strings или $sudo cat /proc/2236/environ | sed 's/\x00/\n/g'

### Вопрос 6. 
Как в Linux или FreeBSD открыть tcp порт 74022 в режиме Listen при помощи утилиты пакета netcat?

### Ответ: 
никак нельзя посмотреть, так как такого порта не может быть.  В протоколе TCP поле "Порт назначения" (DESTINATION PORT) занимает 2 байта, поэтому номер порта не может превышать два в шестнадцатой степени.

### Вопрос 7. 
Как в MySQL посмотреть список текущих сессий?

### Ответ:  
show processlist в консоли mysql или спецальной утилитой mysqladmin с ключиком processlist,  вообщем ключевое слово – processlist.

### Вопрос 8. 
Как в PostgreSQL посмотреть список текущих сессий?

### Ответ:  
Тут нужно делать специальный запрос  в базе:  SELECT * from pg_stat_activity. Или так: $ps axu | grep postgre

### Вопрос 9. 
У Вас на сервере есть древовидная структура директорий с несколькими миллионами файлов. Напишите пример команды, которая удалит все файлы, не трогая структуру каталогов?

### Ответ:  
Это  один из наших любимых вопросов на собеседованиях   Конечно же, это легко делается с помощью команды find.

### Вопрос 10. 
Как не перезагружая операционную систему Linux (ядро 2.6.X), разрешить автоматическую перезагрузку через 10 секунд после того, как произошел kernel panic?

### Ответ:  
$sysctl -w kernel.panic=10 или $echo 10 > /proc/sys/kernel/panic

### Вопрос 11. 
Напишите пример команд из coreutils, при помощи которых можно разбить содержимое текстового файла на три примерно равных части и поместить их в три разных файла?

### Ответ:   
Ну тут опять очень много вариантов, но это точно можно сделать с помощью команд split, dd,  tail или head.  

### Вопрос 12. 
Как посмотреть в содержимое initrd, собранного mkinitramfs?

### Ответ:  
$zcat |cpio -i --make-directories или разархивировать с помощью команды gunzip, а потом  сказать $mount -o loop initrd.img /mnt/initrd

### Вопрос 13. 
Какой утилитой в Linux посмотреть время наработки диска в часах?

### Ответ:  
Например, это можно сделать с помощью smartctl или sg_utils.

### Вопрос 14. 
Как в Linux (2.6.X) безопасно выгрузить модуль ядра e1000e?

### Ответ:  
С помощью команды $modprobe -r e1000e 

### Вопрос 15. 
Как в терминале bash при помощи одной служебной комбинации клавиш слово dpgk превратить в dpkg, если курсор стоит на букве k?

### Ответ:  
Эта комбинация клавиш -  ctrl-T

### Вопрос 16. 
Как в Linux посмотреть лимиты на количество открытых файлов, действующие в текущей сессии?

### Ответ:  
Раз надо посмотреть лимиты, то  логично это делать с помощью команды ulimit -n или ulimit –a

### Вопрос 17. 
Какими командами можно узнать mac-адрес сервера, доступа к которому у Вас нет, и он находится вашем сегменте ethernet сети? При этом известен его ip и до этого момента обмена ip-пакетами с этим сервером не было.

### Ответ:   
Для начала надо с ним обменяться пакетами. Например, это можно сделать с помощью команды ping, ну а потом можно посмотреть его mac  в arp таблице с помощью команды arp. 

### Вопрос 18. 
Какой командой в Linux посмотреть размер журнала файловой системы ext3, смонтированной в /dev/sda1?

### Ответ:  
dumpe2fs -h /dev/sda1 

### Вопрос 19. 
Как в Linux изменить размер файловой системы tmpfs, смонтированной в /tmpfs с 2 до 4 гигабайт, без потери ее содержимого?

### Ответ:  
mount /tmpfs -o remount, size=4g

### Вопрос 20. 
Как в Linux (ядро 2.6.X) одной командой посмотреть содержимое всех таблиц в firewall?

### Ответ: 
Это можно сделать командой iptables-save

### Вопрос 21. 
Какой командой посмотреть, какие из необходимых программе библиотек недоступны при ее запуске?

### Ответ:  
С помощью любимой команды системных администраторов - strace или можно использовать ldd или gdb.

### Вопрос 22. 
Как посмотреть «дерево» процессов?

### Ответ:  
Тут тоже сразу можно привести несколько вариантов: pstree или ps ax --forest или ps axf или ps ax -H

### Вопрос 23. 
Как в Linux прочитать файл /serial.txt, находящейся в ISO9660-образе winxpsp4.iso?

### Ответ: 
По ощущениям вопрос всем очень понравился, запоминайте ответ!  mount -o loop -t iso9660 winxpsp4.iso /mnt;; cat /mnt/serial.txt

### Вопрос 24. 
Что неправильно в параметрах конфигурации интерфейса: 
address 192.168.1.191 
netmask 255.255.255.192 
network 192.168.1.128 
gateway 192.168.1.129 
mtu 1450 ?

### Ответ:  
Адрес хоста (address) совпадает с адресом бродкаста (broadcast) сегмента сети.

### Вопрос 25. 
Как скопировать данные с поврежденного диска /dev/sda на целый /dev/sdb, пропустив только сбойные сектора?

### Ответ:
Классический вариант - dd if=/dev/sda of=/dev/sdb conv=sync,noerror.
Параметр "conv=sync,noerror" указывает dd не читать блок, если при этом происходит ошибка, но записать в архивируемый файл-образ данные (недостающие входные данные будут заменены нулевыми байтами).
Еще есть  утилиты dd_rescue и ddrescue,  с помощью которых тоже можно решить задачу.

### Вопрос 26.
Какой флаг должен быть установлен в tcp пакете, чтобы соединение было немедленно прекращено?

### Ответ: 
RST

### Вопрос 27. 
Как в Linux запретить выделение более 90% физической памяти процессам, при условии, что swap выключен?

### Ответ: 
канонический ответ согласно документации:
$sysctl -w vm.overcommit_memory=2; sysctl -w vm.overcommit_ratio=90 или 
$echo 2 > /proc/sys/vm/overcommit_memory; echo 90 > /proc/sys/vm/overcommit_ratio

### Вопрос 28. 
Как в Linux разрешить маршрутизацию ipv4 пакетов?

### Ответ:  
sysctl -w net.ipv4.ip_forward=1 или echo 1 > /proc/sys/net/ipv4/ip_forward

### Вопрос 29. 
Есть файл file со строками: 
1 
10 
45 
6 
1 
5 
7 
10 
Как при помощи утилит, входящих в coreutils, узнать какие строки присутствуют в файле более 1 раза, и сколько раз повторяется каждая строка?

### Ответ: 
cat file|sort|uniq -dc

### Вопрос 30. 
Вы зашли на сервер example.com и запустили там команду wget http://example.com Как посмотреть траффик этого соединения с помощью команды tcpdump?

### Ответ: 
tcpdump -i lo или -i any
Для общения  между сетевым клиентским программным обеспечением и серверным приложением, расположенном на том же компьютере используется интерфейс loopback.
