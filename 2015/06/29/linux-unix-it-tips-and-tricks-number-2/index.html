<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Linux-Unix-IT Tips and Tricks #2 &#8211; EK</title>
<meta name="description" content="Different Linux / Unix / IT tips, notes, howto part 2

">
<meta name="keywords" content="linux, unix, sysadm">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Linux-Unix-IT Tips and Tricks #2">
<meta name="twitter:description" content="Different Linux / Unix / IT tips, notes, howto part 2

">
<meta name="twitter:site" content="@jivoi">
<meta name="twitter:creator" content="@jivoi">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jivoi.github.io/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_GB">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux-Unix-IT Tips and Tricks #2">
<meta property="og:description" content="Different Linux / Unix / IT tips, notes, howto part 2

">
<meta property="og:url" content="https://jivoi.github.io/2015/06/29/linux-unix-it-tips-and-tricks-number-2/">
<meta property="og:site_name" content="EK">






<link rel="canonical" href="https://jivoi.github.io/2015/06/29/linux-unix-it-tips-and-tricks-number-2/">
<link href="https://jivoi.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="EK Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://jivoi.github.io/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="https://jivoi.github.io/assets/js/vendor/html5shiv.min.js"></script>
	<script src="https://jivoi.github.io/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="https://jivoi.github.io/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://jivoi.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://jivoi.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://jivoi.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://jivoi.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://jivoi.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://jivoi.github.io/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="https://jivoi.github.io/">EK</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="https://jivoi.github.io/archive/" >Archive</a></li>
				
				    
				        
				    
				    <li><a href="https://jivoi.github.io/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="https://jivoi.github.io/feed.xml" >Feed</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    



	<img src="https://jivoi.github.io/images/avatar.jpg" class="bio-photo" alt="EK bio photo">

<h3>EK</h3>
<p>Totally not a hacker</p>
<a href="mailto:ekoz@protonmail.com" class="author-widgets" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
<a href="http://twitter.com/jivoi" class="author-widgets" target="_blank"><i class="fa fa-fw fa-tw-square"></i> Twitter</a>





<a href="http://github.com/jivoi" class="author-widgets" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>










  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="https://jivoi.github.io/2015/06/29/linux-unix-it-tips-and-tricks-number-2/" rel="bookmark" title="Linux-Unix-IT Tips and Tricks #2">Linux-Unix-IT Tips and Tricks #2</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>Different Linux / Unix / IT tips, notes, howto part 2</p>

<section id="table-of-contents" class="toc">
<header>
<h3>Contents</h3>
</header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#other-parts" id="markdown-toc-other-parts">Other parts</a></li>
  <li><a href="#mysql-log-rotate" id="markdown-toc-mysql-log-rotate">MySQL log rotate</a></li>
  <li><a href="#mysql-dump-with-proceduresfunctionstriggers" id="markdown-toc-mysql-dump-with-proceduresfunctionstriggers">MySQL dump with procedures/functions/triggers</a></li>
  <li><a href="#show-last-login-history" id="markdown-toc-show-last-login-history">Show last login history</a></li>
  <li><a href="#enable-postgresql-vacuum" id="markdown-toc-enable-postgresql-vacuum">Enable PostgreSQL Vacuum</a></li>
  <li><a href="#create-geo-db-for-nginx" id="markdown-toc-create-geo-db-for-nginx">Create GEO DB for nginx</a></li>
  <li><a href="#connect-to-com-port-from-freebsd-or-linux" id="markdown-toc-connect-to-com-port-from-freebsd-or-linux">Connect to COM port from FreeBSD or Linux</a></li>
  <li><a href="#upload-ios-to-cisco-routerswitch-from-centos-tftp" id="markdown-toc-upload-ios-to-cisco-routerswitch-from-centos-tftp">Upload IOS to Cisco router\switch from CentOS tftp</a></li>
  <li><a href="#enable-ssh-on-cisco-2960-switch" id="markdown-toc-enable-ssh-on-cisco-2960-switch">Enable SSH on Cisco 2960 switch</a></li>
  <li><a href="#restore-cisco-password" id="markdown-toc-restore-cisco-password">Restore Cisco password</a></li>
  <li><a href="#boot-centos-in-a-single-user-mode" id="markdown-toc-boot-centos-in-a-single-user-mode">Boot CentOS in a Single-User Mode</a></li>
  <li><a href="#delete-mysql-binary-logs" id="markdown-toc-delete-mysql-binary-logs">Delete MySQL binary logs</a></li>
  <li><a href="#show-memory-map-of-a-process" id="markdown-toc-show-memory-map-of-a-process">Show memory map of a process</a></li>
  <li><a href="#show-all-packages-files-in-centos" id="markdown-toc-show-all-packages-files-in-centos">Show all packages files in CentOS</a></li>
  <li><a href="#find-duplicate-files-in-linux" id="markdown-toc-find-duplicate-files-in-linux">Find duplicate files in Linux</a></li>
  <li><a href="#sshsvn-error" id="markdown-toc-sshsvn-error">SSH+SVN error</a></li>
  <li><a href="#kill-all-long-mysql-request" id="markdown-toc-kill-all-long-mysql-request">Kill all long MySQL request</a></li>
  <li><a href="#check-lastack" id="markdown-toc-check-lastack">Check LAST_ACK</a></li>
  <li><a href="#syn-flood-protection" id="markdown-toc-syn-flood-protection">SYN flood protection</a></li>
  <li><a href="#megacli-on-freebsd" id="markdown-toc-megacli-on-freebsd">MegaCli on FreeBSD</a></li>
  <li><a href="#convert-mysql-db-from-cp1251-to-utf8" id="markdown-toc-convert-mysql-db-from-cp1251-to-utf8">Convert MySQL db from cp1251 to Utf8</a></li>
  <li><a href="#insert-text-in-the-top-of-file" id="markdown-toc-insert-text-in-the-top-of-file">Insert text in the top of file</a></li>
  <li><a href="#ipmi-in-linux-of-freebsd" id="markdown-toc-ipmi-in-linux-of-freebsd">IPMI in Linux of FreeBSD</a></li>
  <li><a href="#disable-nginxapache-server-token" id="markdown-toc-disable-nginxapache-server-token">Disable NginX\Apache server token</a></li>
  <li><a href="#show-installed-perl-modules" id="markdown-toc-show-installed-perl-modules">Show installed perl modules</a></li>
  <li><a href="#use-stracelsof" id="markdown-toc-use-stracelsof">Use strace\lsof</a></li>
  <li><a href="#create-patch" id="markdown-toc-create-patch">Create Patch</a></li>
  <li><a href="#create-gstripe-in-freebsd" id="markdown-toc-create-gstripe-in-freebsd">Create gstripe in FreeBSD</a></li>
  <li><a href="#delete-trailing-spaces-in-text-with-vim" id="markdown-toc-delete-trailing-spaces-in-text-with-vim">Delete trailing spaces in text with VIM</a></li>
  <li><a href="#disable-apache-dir-listing" id="markdown-toc-disable-apache-dir-listing">Disable Apache dir listing</a></li>
  <li><a href="#mysql-load-data-grant" id="markdown-toc-mysql-load-data-grant">MySQL load data grant</a></li>
  <li><a href="#mysql-grants-for-fields-in-table" id="markdown-toc-mysql-grants-for-fields-in-table">MySQL grants for fields in table</a></li>
  <li><a href="#determine-max-mtu" id="markdown-toc-determine-max-mtu">Determine MAX MTU</a></li>
  <li><a href="#upgrade-centos-password-hashing" id="markdown-toc-upgrade-centos-password-hashing">Upgrade CentOS Password Hashing</a></li>
  <li><a href="#linux-pkg-search" id="markdown-toc-linux-pkg-search">Linux Pkg search</a></li>
  <li><a href="#run-echo-cmd-with-sudo" id="markdown-toc-run-echo-cmd-with-sudo">Run echo cmd with sudo</a></li>
  <li><a href="#change-percentage-of-root-fs" id="markdown-toc-change-percentage-of-root-fs">Change percentage of root FS</a></li>
  <li><a href="#disable-ipv6-on-centos" id="markdown-toc-disable-ipv6-on-centos">Disable Ipv6 on CentOS</a></li>
  <li><a href="#fix-chmod--x-chmod" id="markdown-toc-fix-chmod--x-chmod">Fix chmod -x chmod</a></li>
  <li><a href="#get-webserver-http-code-answer" id="markdown-toc-get-webserver-http-code-answer">Get webserver http code answer</a></li>
  <li><a href="#clone-disk-with-dd-by-network" id="markdown-toc-clone-disk-with-dd-by-network">Clone disk with DD by network</a></li>
  <li><a href="#ssh-x11-forwarding" id="markdown-toc-ssh-x11-forwarding">SSH x11 forwarding</a></li>
  <li><a href="#extract-rpm-pkg" id="markdown-toc-extract-rpm-pkg">Extract RPM pkg</a></li>
  <li><a href="#create-ffs-snapshot" id="markdown-toc-create-ffs-snapshot">Create FFS snapshot</a></li>
  <li><a href="#exim-cli-commands" id="markdown-toc-exim-cli-commands">Exim cli commands</a></li>
  <li><a href="#clean-postfix-queue" id="markdown-toc-clean-postfix-queue">Clean Postfix queue</a></li>
  <li><a href="#find-all-notpkgs-files-freebsd" id="markdown-toc-find-all-notpkgs-files-freebsd">Find all notpkgs files FreeBSD</a></li>
  <li><a href="#display-real-lvm-block-devices" id="markdown-toc-display-real-lvm-block-devices">Display real LVM block devices</a></li>
  <li><a href="#mount-iso-in-freebsd" id="markdown-toc-mount-iso-in-freebsd">Mount ISO in FreeBSD</a></li>
  <li><a href="#cisco-css-1501-tacacs" id="markdown-toc-cisco-css-1501-tacacs">Cisco CSS 1501 Tacacs</a>    <ul>
      <li><a href="#show-freebsd-kernel-config" id="markdown-toc-show-freebsd-kernel-config">Show FreeBSD kernel config</a></li>
      <li><a href="#http-redirect-with-html-and-javascript" id="markdown-toc-http-redirect-with-html-and-javascript">HTTP redirect with HTML and JavaScript</a></li>
    </ul>
  </li>
</ul>

  </div>
</section>
<!-- /#table-of-contents -->

<h3 id="other-parts">Other parts</h3>
<p><a href="https://jivoi.github.io/2014/06/22/linux-unix-it-tips-and-tricks-number-1/">Part 1</a>
<a href="https://jivoi.github.io/2015/06/29/linux-unix-it-tips-and-tricks-number-2/">Part 2</a>
<a href="https://jivoi.github.io/2015/07/01/linux-unix-it-tips-and-tricks-number-3/">Part 3</a></p>

<h3 id="mysql-log-rotate">MySQL log rotate</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">/etc/logrotate.d/mysql
/logs/mysql/mysql /logs/mysql/mysql.err /logs/mysql/mysql-slow.log /logs/mysql/query.log <span class="o">{</span>
        notifempty
        daily
        rotate 7
        missingok
        compress
        sharedscripts
        postrotate
        <span class="c"># just if mysqld is really running</span>
        <span class="k">if</span> <span class="nb">test</span> -x /usr/bin/mysqladmin <span class="o">&amp;&amp;</span> <span class="se">\</span>
           /usr/bin/mysqladmin ping <span class="p">&amp;</span>&gt;/dev/null
        <span class="k">then</span>
           /usr/bin/mysqladmin flush-logs
        <span class="k">fi</span>
    endscript
<span class="o">}</span></code></pre></div>

<h3 id="mysql-dump-with-proceduresfunctionstriggers">MySQL dump with procedures/functions/triggers</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">mysqldump --routines --no-create-info --no-data --no-create-db --skip-opt &lt;database&gt; &gt; outputfile.sql
mysql &lt;database&gt; &lt; outputfile.sql</code></pre></div>

<h3 id="show-last-login-history">Show last login history</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">last -f  /var/log/wtmp.0
 -f file  Specifies a file to search other than /var/log/wtmp.</code></pre></div>

<h3 id="enable-postgresql-vacuum">Enable PostgreSQL Vacuum</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">vacuum full VERBOSE analyze<span class="p">;</span></code></pre></div>

<h3 id="create-geo-db-for-nginx">Create GEO DB for nginx</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">For use by the ngx_http_geo_module
wget http://geolite.maxmind.com/download/geoip/database/GeoIPCountryCSV.zip
unzip GeoIPCountryCSV.zip
wget https://raw.githubusercontent.com/simplegeo/nginx/master/contrib/geo2nginx.pl
perl geo2nginx.pl &lt; GeoIPCountryWhois.csv &gt; geo.conf</code></pre></div>

<h3 id="connect-to-com-port-from-freebsd-or-linux">Connect to COM port from FreeBSD or Linux</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">FreeBSD:
tip -vs9600 com1
to disconnect  <span class="nb">shift</span>+~~+.

or
cu -l /dev/cuau0 -s9600

Linux:
minicom -s
/dev/ttyS0
<span class="m">9600</span> 8N1
sudo -u root minicom -s</code></pre></div>

<h3 id="upload-ios-to-cisco-routerswitch-from-centos-tftp">Upload IOS to Cisco router\switch from CentOS tftp</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">centos# yum -y install tftp-server tftp
centos# /etc/xinetd.d/tftp
<span class="nv">disable</span> <span class="o">=</span> no
centos# service xinetd start

switch# copy tftp: flash:
switch# dir flash:
switch#show boot
switch# configure terminal
switch# <span class="o">(</span>config<span class="o">)</span><span class="c">#boot system flash:c3550-i5q3l2-mz.121-13.</span></code></pre></div>

<h3 id="enable-ssh-on-cisco-2960-switch">Enable SSH on Cisco 2960 switch</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">You IOS must support K9, ex c2960s-universalk9-mz.122-55.SE3.bin

conf t
ip domain-name domain.com
crypto key generate rsa

line vty <span class="m">0</span> 4
transport input ssh
<span class="nb">exec</span>-timeout <span class="m">0</span> 0</code></pre></div>

<h3 id="restore-cisco-password">Restore Cisco password</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">Connect COM port
Reboot router and <span class="nb">wait</span> «Self decompressing the image: » press Ctrl-C or Ctrl-Break
confreg 0x2142<span class="o">(</span>default -  2102<span class="o">)</span>
reload
copy start run
make change with config
config-register 0x2102
reload</code></pre></div>

<h3 id="boot-centos-in-a-single-user-mode">Boot CentOS in a Single-User Mode</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">add to grub line that start with kernel - single
or
<span class="nv">init</span><span class="o">=</span>/bin/sh</code></pre></div>

<h3 id="delete-mysql-binary-logs">Delete MySQL binary logs</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">/etc/my.cnf
<span class="nv">expire_logs_days</span> <span class="o">=</span> 7
PURGE BINARY LOGS TO <span class="s1">&#39;mysqld-bin.000123&#39;</span><span class="p">;</span></code></pre></div>

<h3 id="show-memory-map-of-a-process">Show memory map of a process</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">pmap PID</code></pre></div>

<h3 id="show-all-packages-files-in-centos">Show all packages files in CentOS</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">for</span> i in <span class="sb">`</span>rpm -qa<span class="sb">`</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="nv">$i</span><span class="p">;</span> rpm -ql <span class="nv">$i</span><span class="p">;</span> <span class="k">done</span></code></pre></div>

<h3 id="find-duplicate-files-in-linux">Find duplicate files in Linux</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">for</span> i in <span class="sb">`</span>find *<span class="sb">`</span><span class="p">;</span> <span class="k">do</span> <span class="o">[</span> -f <span class="s2">&quot;$i&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;`md5sum \&quot;$i\&quot;`&quot;</span><span class="p">;</span> <span class="k">done</span> <span class="p">|</span> sort <span class="p">|</span> awk -- <span class="s1">&#39;{ if (LAST==$1) print; else LAST=$1 }</span>
<span class="s1">or</span>
<span class="s1">find /dir -type f -print0 | xargs -0 md5sum | sort | uniq -w32 -D # |awk &#39;</span><span class="o">{</span>print <span class="nv">$2</span><span class="o">}</span><span class="err">&#39;</span></code></pre></div>

<h3 id="sshsvn-error">SSH+SVN error</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ssh svn: Network connection closed unexpectedly
This mean that you dont have sshkey fingerprint in know_hosts
try ssh to server first</code></pre></div>

<h3 id="kill-all-long-mysql-request">Kill all long MySQL request</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">mysql -e <span class="s1">&#39;show full processlist&#39;</span><span class="p">|</span>grep -v Command <span class="p">|</span>awk <span class="s1">&#39;{if ($6 &gt;= 10) print &quot;kill &quot; $1 &quot;;&quot;}&#39;</span> <span class="p">|</span>mysql</code></pre></div>

<h3 id="check-lastack">Check LAST_ACK</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">LAST_ACK - mean that remote host is disconnected and socker is closed, we are waiting acknowledgment

sysctl -a <span class="p">|</span>grep last_ack
net.ipv4.netfilter.ip_conntrack_tcp_timeout_last_ack <span class="o">=</span> 30
sysctl -w net.ipv4.netfilter.ip_conntrack_tcp_timeout_last_ack<span class="o">=</span>10
netstat -ant <span class="p">|</span> fgrep <span class="s2">&quot;:&quot;</span> <span class="p">|</span> cut -b 77-90 <span class="p">|</span> sort <span class="p">|</span> uniq -c

cat /proc/sys/net/netfilter/nf_conntrack_count
cat /proc/sys/net/ipv4/netfilter/ip_conntrack_count
cat /proc/sys/net/ipv4/ip_conntrack_max
<span class="nb">echo </span><span class="m">131072</span> &gt; /proc/sys/net/ipv4/ip_conntrack_max
sysctl net.ipv4.netfilter.ip_conntrack_max<span class="o">=</span>1048576

or disable conntrack <span class="k">for</span> port

iptables -A INPUT -p tcp --dport <span class="m">443</span> -j ACCEPT
iptables -t raw -A PREROUTING -p tcp --dport <span class="m">443</span> -j NOTRACK</code></pre></div>

<h3 id="syn-flood-protection">SYN flood protection</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">&quot;20000&quot;</span> &gt; /proc/sys/net/ipv4/tcp_max_syn_backlog
<span class="nb">echo</span> <span class="s2">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/tcp_synack_retries
<span class="nb">echo</span> <span class="s2">&quot;30&quot;</span> &gt; /proc/sys/net/ipv4/tcp_fin_timeout
<span class="nb">echo</span> <span class="s2">&quot;5&quot;</span> &gt; /proc/sys/net/ipv4/tcp_keepalive_probes
<span class="nb">echo</span> <span class="s2">&quot;15&quot;</span> &gt; /proc/sys/net/ipv4/tcp_keepalive_intvl
<span class="nb">echo</span> <span class="s2">&quot;20000&quot;</span> &gt; /proc/sys/net/core/netdev_max_backlog
<span class="nb">echo</span> <span class="s2">&quot;20000&quot;</span> &gt; /proc/sys/net/core/somaxconn

iptables -N syn_flood
<span class="nv">$IPT</span> -A INPUT -p tcp --syn -j syn_flood
<span class="nv">$IPT</span> -A syn_flood -m limit --limit 500/s --limit-burst <span class="m">1500</span> -j RETURN
<span class="nv">$IPT</span> -A syn_flood -j DROP</code></pre></div>

<h3 id="megacli-on-freebsd">MegaCli on FreeBSD</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">Install linux compat from ports
mkdir -p /usr/compat/linux/proc
linsys          /compat/linux/sys       linsysfs        rw <span class="m">0</span> 0
linproc         /compat/linux/proc      linprocfs       rw <span class="m">0</span> 0
mount linsys
mount linproc
MegaCli -CfgDsply -a0</code></pre></div>

<h3 id="convert-mysql-db-from-cp1251-to-utf8">Convert MySQL db from cp1251 to Utf8</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">mysqldump --default-character-set<span class="o">=</span>utf8 database &gt; database.utf8.sql
mysql --default-character-set<span class="o">=</span>utf8 database_new &lt; database.utf8.sql

or
mysqldump -u admin --password<span class="o">=</span>PASS --opt --default-character-set<span class="o">=</span>latin1 --skip-set-charset -Q DB_NAME &gt; database.sql
sed -i <span class="s1">&#39;s/character set cp1251 collate cp1251_bin/character set utf8 collate utf8_bin/&#39;</span> database.sql
sed -i <span class="s1">&#39;s/CHARSET=cp1251/CHARSET=utf8/&#39;</span> database.sql</code></pre></div>

<h3 id="insert-text-in-the-top-of-file">Insert text in the top of file</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">perl -i~ -0777pe<span class="s1">&#39;s/^/New first line\n/&#39;</span> yourfile</code></pre></div>

<h3 id="ipmi-in-linux-of-freebsd">IPMI in Linux of FreeBSD</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">Linux
yum install OpenIPMI OpenIPMI-tools
http://www.openfusion.net/linux/ipmi_on_centos
/sbin/modprobe ipmi_devintf<span class="p">;</span> /sbin/modprobe ipmi_si<span class="p">;</span> /sbin/modprobe ipmi_msghandler
<span class="c"># Logging</span>
ipmitool sel info
ipmitool sel list

FreeBSD
<span class="c"># kldload ipmi</span>
<span class="c"># dmesg | tail</span>
ipmi0:  on isa0
ipmi0: KCS mode found at io 0xca2 alignment 0x1 on isa
ipmi0: IPMI device rev. 1, firmware rev. 0.2, version 2.0
ipmi0: Number of channels 2
ipmi0: Attached watchdog

<span class="c"># ipmitool chassis status</span>
System Power         : on
Power Overload       : <span class="nb">false</span>
Power Interlock      : inactive
Main Power Fault     : <span class="nb">false</span>
Power Control Fault  : <span class="nb">false</span>
Power Restore Policy : always-on
Last Power Event     : <span class="nb">command</span></code></pre></div>

<h3 id="disable-nginxapache-server-token">Disable NginX\Apache server token</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">NginX
server_tokens off

Apache
ServerTokens ProductOnly
ServerSignature Off</code></pre></div>

<h3 id="show-installed-perl-modules">Show installed perl modules</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">perl -MFile::Find<span class="o">=</span>find -MFile::Spec::Functions -Tlwe <span class="se">\</span>
<span class="s1">&#39;find { wanted =&gt; sub { print canonpath $_ if /\.pm\z/ }, no_chdir =&gt; 1 }, @INC&#39;</span></code></pre></div>

<h3 id="use-stracelsof">Use strace\lsof</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">strace -e <span class="nv">trace</span><span class="o">=</span>network -p PID
strace <span class="k">$(</span>pidof httpd <span class="p">|</span>sed <span class="s1">&#39;s/\([0-9]*\)/\-p \1/g&#39;</span><span class="k">)</span>

lsof -nPp PID
lsof -a -U -u username
lsof -F pcfn
lsof +d /mnt/DIR
lsof +D /mnt/DIR
lsof -i <span class="o">[</span>46<span class="o">][</span>protocol<span class="o">][</span>@hostname<span class="p">|</span>hostaddr<span class="o">][</span>:service<span class="p">|</span>port<span class="o">]</span></code></pre></div>

<h3 id="create-patch">Create Patch</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">diff -crB tmpl_lib.c.orig tmpl_lib.c &gt; tmpl_lib.patchс
patch -p1 -i tmpl_lib.patch</code></pre></div>

<h3 id="create-gstripe-in-freebsd">Create gstripe in FreeBSD</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">kldload geom_stripe
sysctl kern.geom.debugflags<span class="o">=</span>16
gstripe lable -v st0 /dev/da1 /dev/da2 /dev/da3 /dev/da4 /dev/da5
gstripe create -v st0 /dev/da1 /dev/da2 /dev/da3 /dev/da4 /dev/da5
bsdlabel -wB /dev/stripe/st0
newfs -O <span class="m">2</span> -U /dev/stripe/st0a
mount /dev/stripe/st0a /www

<span class="nb">echo</span> <span class="s1">&#39;geom_stripe_load=&quot;YES&quot;&#39;</span> &gt;&gt; /boot/loader.conf

/etc/fstab
/dev/stripe/st0a       /www           ufs     rw,noatime              <span class="m">2</span>       2

tunefs -m <span class="m">1</span> /dev/stripe/st0a</code></pre></div>

<h3 id="delete-trailing-spaces-in-text-with-vim">Delete trailing spaces in text with VIM</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">:%s/<span class="se">\s\+</span><span class="nv">$/</span>/
delete blank lines
:g/^<span class="nv">$/</span>d</code></pre></div>

<h3 id="disable-apache-dir-listing">Disable Apache dir listing</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">&lt;Directory /&gt;
    Options -Indexes
    AllowOverride all
    Order allow,deny
    Allow from all
&lt;/Directory&gt;</code></pre></div>

<h3 id="mysql-load-data-grant">MySQL load data grant</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">grant file on *.* to user@localhost identified by <span class="s1">&#39;P@ssw0rd&#39;</span><span class="p">;</span></code></pre></div>

<h3 id="mysql-grants-for-fields-in-table">MySQL grants for fields in table</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">GRANT SELECT <span class="o">(</span>col1<span class="o">)</span>, INSERT <span class="o">(</span>col1,col2<span class="o">)</span> ON mydb.mytbl TO <span class="s1">&#39;someuser&#39;</span>@<span class="s1">&#39;somehost&#39;</span><span class="p">;</span></code></pre></div>

<h3 id="determine-max-mtu">Determine MAX MTU</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ping ya.ru -v -M dont -s <span class="m">1472</span> -W 1</code></pre></div>

<h3 id="upgrade-centos-password-hashing">Upgrade CentOS Password Hashing</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">authconfig --test <span class="p">|</span> grep hashing
authconfig --passalgo<span class="o">=</span>sha512 --update</code></pre></div>

<h3 id="linux-pkg-search">Linux Pkg search</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">http://pkgs.org/</code></pre></div>

<h3 id="run-echo-cmd-with-sudo">Run echo cmd with sudo</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">for</span> i in server<span class="p">;</span><span class="k">do</span> <span class="nb">echo</span> <span class="nv">$i</span><span class="p">;</span> <span class="nb">echo</span> <span class="s1">&#39;echo &quot;&quot;&#39;</span> &gt;  /logs/test.log<span class="err">&#39;</span><span class="p">|</span>ssh <span class="nv">$i</span> sudo sh<span class="p">;</span><span class="k">done</span></code></pre></div>

<h3 id="change-percentage-of-root-fs">Change percentage of root FS</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">tune2fs -m <span class="m">0</span> /dev/sdc1</code></pre></div>

<h3 id="disable-ipv6-on-centos">Disable Ipv6 on CentOS</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">&quot;alias net-pf-10 off&quot;</span> &gt;/etc/modprobe.conf
<span class="nb">echo</span> <span class="s2">&quot;alias ipv6 off&quot;</span> &gt;&gt;/etc/modprobe.conf
chkconfig ip6tables off
sed -i <span class="s1">&#39;s/NETWORKING_IPV6=yes/NETWORKING_IPV6=no/g&#39;</span> /etc/sysconfig/network
reboot</code></pre></div>

<h3 id="fix-chmod--x-chmod">Fix chmod -x chmod</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">perl -e <span class="s1">&#39;chmod 0755, &quot;/bin/chmod&quot;&#39;</span>
python -c <span class="s1">&#39;import os; os.chmod(&quot;chmod&quot;, 0755)&#39;</span>

or

cp /bin/sh ~/chmod2
cat /bin/chmod &gt; ~/chmod2
sudo ~/chmod2 +x /bin/chmod
rm ~/chmod2

or

sudo apt-get --reinstall install <span class="sb">`</span>dpkg -S /bin/chmod <span class="p">|</span> cut -f1 -d:<span class="sb">`</span>

gcc -x c - <span class="s">&lt;&lt;CHMOD</span>
<span class="s">#include &lt;sys/stat.h&gt;</span>
<span class="s">main(){chmod(&quot;/bin/chmod&quot;, S_IXUSR | S_IXGRP | S_IXOTH);}</span>
<span class="s">CHMOD</span>
sudo ./a.out
rm a.out

or

/lib/ld-linux-x86-64.so.2 /bin/chown +x /bin/chown</code></pre></div>

<h3 id="get-webserver-http-code-answer">Get webserver http code answer</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">wget --server-response -T <span class="m">5</span> -t <span class="m">1</span> http://ya.ru 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> awk <span class="s1">&#39;/^  HTTP/{print $2}&#39;</span></code></pre></div>

<h3 id="clone-disk-with-dd-by-network">Clone disk with DD by network</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">dd <span class="k">if</span><span class="o">=</span>/dev/sdd1 <span class="nv">bs</span><span class="o">=</span>1M <span class="p">|</span> ssh -c arcfour user@server <span class="s2">&quot;dd of=/dev/sdf1 bs=1M&quot;</span> <span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;dd of disk1@server1 is finished&quot;</span> <span class="p">|</span> mail -s <span class="s2">&quot;DD_CLONE&quot;</span> adm@server.net

disk with errors
dd <span class="k">if</span><span class="o">=</span>/dev/sdd1 <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">conv</span><span class="o">=</span>sync,noerror <span class="p">|</span> ssh -c arcfour user@server <span class="s2">&quot;dd of=/dev/sdd1 bs=1M&quot;</span>

use nc
dd <span class="k">if</span><span class="o">=</span>/dev/sde1 <span class="nv">bs</span><span class="o">=</span>1M <span class="p">|</span> nc newserver 7000
nc -l <span class="m">7000</span> <span class="p">|</span> dd <span class="nv">of</span><span class="o">=</span>/dev/sde1 <span class="nv">bs</span><span class="o">=</span>1M</code></pre></div>

<h3 id="ssh-x11-forwarding">SSH x11 forwarding</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">yum install xorg-x11-xauth
apt-get install xauth
ssh -X</code></pre></div>

<h3 id="extract-rpm-pkg">Extract RPM pkg</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">rpm2cpio myrpmfile.rpm <span class="p">|</span> cpio -idmv</code></pre></div>

<h3 id="create-ffs-snapshot">Create FFS snapshot</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">mksnap_ffs /www/.snap/1
mdconfig -a -t vnode -o <span class="nb">readonly</span> -f /www/.snap/1
mount -o ro /dev/md0 /mnt/
sync
umount -f /mnt
sync
mdconfig -d -u /dev/md0
sync
rm -f /www/.snap/1
sync</code></pre></div>

<h3 id="exim-cli-commands">Exim cli commands</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># remove from queue frozen messages</span>
exiqgrep -z -i<span class="p">|</span>xargs exim -Mrm
exipick -zi <span class="p">|</span> xargs exim4 -Mrm
exim -bp <span class="p">|</span> awk <span class="s1">&#39;$6~&quot;frozen&quot; { print $3 }&#39;</span> <span class="p">|</span> xargs exim -Mrm
<span class="c"># view a message&#39;s headers</span>
exim -Mvh &lt;message-id&gt;
<span class="c"># view a message&#39;s body</span>
exim -Mvb &lt;message-id&gt;
<span class="c"># remove from queue messages older than week</span>
exipick -io <span class="m">86400</span> <span class="p">|</span> xargs exim4 -Mrm
<span class="c"># remove all messages from queue</span>
exipick -i <span class="p">|</span> xargs exim4 -Mrm
<span class="c"># remove message by ID</span>
exim -v -Mrm ID
<span class="c"># frozen message by email</span>
exiqgrep -i -f email <span class="p">|</span> xargs exim -Mf
<span class="c"># remove messages by email</span>
exiqgrep -i -f email <span class="p">|</span> xargs exim -Mrm</code></pre></div>

<h3 id="clean-postfix-queue">Clean Postfix queue</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">mailq<span class="p">|</span>grep <span class="s1">&#39;MAILER-DAEMON&#39;</span><span class="p">|</span>awk <span class="s1">&#39;{print $1}&#39;</span><span class="p">|</span>postsuper -d -</code></pre></div>

<h3 id="find-all-notpkgs-files-freebsd">Find all notpkgs files FreeBSD</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">find /usr/local -type f <span class="p">|</span> xargs -J% pkg_which -v <span class="s2">&quot;%&quot;</span> <span class="p">|</span>  fgrep <span class="s1">&#39;?&#39;</span></code></pre></div>

<h3 id="display-real-lvm-block-devices">Display real LVM block devices</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">lvdisplay<span class="p">|</span> awk <span class="s1">&#39;/LV Name/{n=$3} /Block device/{d=$3; sub(&quot;.*:&quot;,&quot;dm-&quot;,d); print d,n;}&#39;</span>
lvdisplay<span class="p">|</span> awk <span class="s1">&#39;/LV Name/{blockdev=$3} /Block device/{bdid=$3; sub(&quot;[0-9]*:&quot;,&quot;dm-&quot;,bdid); print bdid,blockdev;}&#39;</span></code></pre></div>

<h3 id="mount-iso-in-freebsd">Mount ISO in FreeBSD</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">mdconfig -a -t vnode -f image.iso -u 0
mount -t cd9660 -o ro /dev/md0 /mount_point
umount /mount_point
mdconfig -d -u 0</code></pre></div>

<h2 id="cisco-css-1501-tacacs">Cisco CSS 1501 Tacacs</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">virtual authentication primary tacacs
virtual authentication secondary <span class="nb">local</span>
tacacs-server authorize config
tacacs-server authorize non-config
tacacs-server account non-config
tacacs-server account config
tacacs-server X.X.X.X primary frequency 10
tacacs-server key SecretKeyCisco</code></pre></div>

<h3 id="show-freebsd-kernel-config">Show FreeBSD kernel config</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sysctl -b kern.conftxt</code></pre></div>

<h3 id="http-redirect-with-html-and-javascript">HTTP redirect with HTML and JavaScript</h3>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>301 moved permanently<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;robots&quot;</span> <span class="na">content=</span><span class="s">&quot;noindex&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;refresh&quot;</span> <span class="na">content=</span><span class="s">&quot;0; url=http://example.ru/goto.html&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="c">&lt;!-- &lt;a href=&quot;http://example.ru/goto.html&quot;&gt;Moved permanently&lt;/a&gt; --&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!--</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">&quot;http://example.ru/goto.html&quot;</span><span class="p">;</span>
<span class="err">// --&gt;</span><span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></div>


      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          



	<img src="https://jivoi.github.io/images/avatar.jpg" class="bio-photo" alt="EK bio photo">

<h3>EK</h3>
<p>Totally not a hacker</p>
<a href="mailto:ekoz@protonmail.com" class="author-widgets" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
<a href="http://twitter.com/jivoi" class="author-widgets" target="_blank"><i class="fa fa-fw fa-tw-square"></i> Twitter</a>





<a href="http://github.com/jivoi" class="author-widgets" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>










        </div>
        <p class="byline"><strong>Linux-Unix-IT Tips and Tricks #2</strong> was published on <time datetime="2015-06-29T00:00:00+03:00">June 29, 2015</time> and last modified on <time datetime="2014-06-29">June 29, 2014</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="https://jivoi.github.io/archive/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="https://jivoi.github.io/2016/04/04/move-from-hdd-to-ssd-with-archlinux/" title="Move from HDD to SSD with ArchLinux">Move from HDD to SSD with ArchLinux</a></li>
    
      <li><a href="https://jivoi.github.io/2016/01/22/linux-sysadm-devops-interview-questions/" title="Linux SysAdm/DevOps Interview Questions">Linux SysAdm/DevOps Interview Questions</a></li>
    
      <li><a href="https://jivoi.github.io/2015/12/30/archlinux-installation-guide/" title="ArchLinux Installation Guide">ArchLinux Installation Guide</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://jivoi.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://jivoi.github.io/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-64125092-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'http-jivoi-github-io'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    // (function() {
    //     var dsq = document.createElement('script');
    //     dsq.type = 'text/javascript'; dsq.async = true;
    //     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    //     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    // })();

    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//http-jivoi-github-io.disqus.com/embed.js';
    s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script');
        s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());



</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



	        

</body>
</html>
