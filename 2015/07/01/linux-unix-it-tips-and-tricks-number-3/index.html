<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title> Linux-Unix-IT Tips and Tricks #3 &#8211; EK</title>
<meta name="description" content="Different Linux / Unix / IT tips, notes, howto part 3

">
<meta name="keywords" content="linux, unix, sysadm">



<!-- Twitter Cards -->
<meta name="twitter:title" content=" Linux-Unix-IT Tips and Tricks #3">
<meta name="twitter:description" content="Different Linux / Unix / IT tips, notes, howto part 3

">
<meta name="twitter:site" content="@jivoi">
<meta name="twitter:creator" content="@jivoi">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jivoi.github.io/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_GB">
<meta property="og:type" content="article">
<meta property="og:title" content=" Linux-Unix-IT Tips and Tricks #3">
<meta property="og:description" content="Different Linux / Unix / IT tips, notes, howto part 3

">
<meta property="og:url" content="https://jivoi.github.io/2015/07/01/linux-unix-it-tips-and-tricks-number-3/">
<meta property="og:site_name" content="EK">





<link rel="canonical" href="https://jivoi.github.io/2015/07/01/linux-unix-it-tips-and-tricks-number-3/">
<link href="https://jivoi.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="EK Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://jivoi.github.io/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="https://jivoi.github.io/assets/js/vendor/html5shiv.min.js"></script>
	<script src="https://jivoi.github.io/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="https://jivoi.github.io/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://jivoi.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://jivoi.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://jivoi.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://jivoi.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://jivoi.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://jivoi.github.io/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="https://jivoi.github.io/">EK</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="https://jivoi.github.io/archive/" >Archive</a></li>
				
				    
				        
				    
				    <li><a href="https://jivoi.github.io/about/" >About</a></li>
				
				    
				        
				    
				    <li><a href="https://jivoi.github.io/feed.xml" >Feed</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    



	<img src="https://jivoi.github.io/images/avatar.jpg" class="bio-photo" alt="EK bio photo">

<h3>EK</h3>
<p>I'm a hacker and security researcher</p>
<a href="mailto:ekoz@protonmail.com" class="author-widgets" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
<a href="http://twitter.com/jivoi" class="author-widgets" target="_blank"><i class="fa fa-fw fa-tw-square"></i> Twitter</a>





<a href="http://github.com/jivoi" class="author-widgets" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>










  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="https://jivoi.github.io/2015/07/01/linux-unix-it-tips-and-tricks-number-3/" rel="bookmark" title=" Linux-Unix-IT Tips and Tricks #3"> Linux-Unix-IT Tips and Tricks #3</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>Different Linux / Unix / IT tips, notes, howto part 3</p>

<section id="table-of-contents" class="toc">
<header>
<h3>Contents</h3>
</header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#other-parts" id="markdown-toc-other-parts">Other parts</a></li>
  <li><a href="#speed-up-mysql-import" id="markdown-toc-speed-up-mysql-import">Speed up MySQL Import</a></li>
  <li><a href="#coreutils-list" id="markdown-toc-coreutils-list">Coreutils List</a></li>
  <li><a href="#list-all-process-swap-space-usage" id="markdown-toc-list-all-process-swap-space-usage">List all process swap space usage</a></li>
  <li><a href="#delete-millions-files-from-dir" id="markdown-toc-delete-millions-files-from-dir">Delete millions files from dir</a></li>
  <li><a href="#nice-diff" id="markdown-toc-nice-diff">Nice Diff</a></li>
  <li><a href="#run-jobs-with-parallel" id="markdown-toc-run-jobs-with-parallel">Run jobs with parallel</a></li>
  <li><a href="#awk-ps-sum" id="markdown-toc-awk-ps-sum">Awk PS SUM</a></li>
  <li><a href="#show-ext4-fragmentation-" id="markdown-toc-show-ext4-fragmentation-">Show ext4 fragmentation %</a></li>
  <li><a href="#statistic-of-system-resource" id="markdown-toc-statistic-of-system-resource">Statistic of system resource</a></li>
  <li><a href="#tcpdump-with-ssh-stream" id="markdown-toc-tcpdump-with-ssh-stream">Tcpdump with SSH stream</a></li>
  <li><a href="#linux-namespaces" id="markdown-toc-linux-namespaces">Linux Namespaces</a></li>
  <li><a href="#show-daemon-list-need-to-restart-after-update" id="markdown-toc-show-daemon-list-need-to-restart-after-update">Show daemon list need to restart after update</a></li>
  <li><a href="#increases-tcpdump-buffer" id="markdown-toc-increases-tcpdump-buffer">Increases TCPdump buffer</a></li>
  <li><a href="#get-firefox-bookmarks" id="markdown-toc-get-firefox-bookmarks">Get Firefox bookmarks</a></li>
  <li><a href="#ssl-certs-info" id="markdown-toc-ssl-certs-info">SSL certs info</a></li>
  <li><a href="#reset-root-password-on-rhel7centos7" id="markdown-toc-reset-root-password-on-rhel7centos7">Reset root password on RHEL7\CentOS7</a>    <ul>
      <li><a href="#blacklisting-firewire-in-linux" id="markdown-toc-blacklisting-firewire-in-linux">Blacklisting firewire in Linux</a></li>
      <li><a href="#install-ubuntu-openstack" id="markdown-toc-install-ubuntu-openstack">Install Ubuntu OpenStack</a></li>
      <li><a href="#vagrant-winxp" id="markdown-toc-vagrant-winxp">Vagrant WinXP</a></li>
      <li><a href="#simple-cut-video-in-linux" id="markdown-toc-simple-cut-video-in-linux">Simple Cut Video in linux</a></li>
      <li><a href="#how-to-clean-tmp-dir-on-boot" id="markdown-toc-how-to-clean-tmp-dir-on-boot">How to clean TMP dir on boot</a></li>
      <li><a href="#the-port-scan-attack-detector---psad" id="markdown-toc-the-port-scan-attack-detector---psad">The port scan attack detector - PSAD</a></li>
      <li><a href="#snmptrap-using" id="markdown-toc-snmptrap-using">SNMPTrap using</a></li>
      <li><a href="#remove-postfix-resiver-header" id="markdown-toc-remove-postfix-resiver-header">Remove Postfix Resiver Header</a></li>
      <li><a href="#ssh-key-login-only-for-one-user" id="markdown-toc-ssh-key-login-only-for-one-user">SSH key login only for one user</a></li>
      <li><a href="#revert-firefox-to-init-state" id="markdown-toc-revert-firefox-to-init-state">Revert Firefox to init state</a></li>
      <li><a href="#limit-mysql-and-mongodb-mem-usage-with-cgroups" id="markdown-toc-limit-mysql-and-mongodb-mem-usage-with-cgroups">Limit MySQL and MongoDB mem usage with Cgroups</a></li>
      <li><a href="#strace-using" id="markdown-toc-strace-using">Strace using</a></li>
      <li><a href="#linux-system-errors-types" id="markdown-toc-linux-system-errors-types">Linux System Errors Types</a></li>
      <li><a href="#auditd" id="markdown-toc-auditd">Auditd</a></li>
      <li><a href="#mysql-version-from-an-frm-file" id="markdown-toc-mysql-version-from-an-frm-file">MySQL version from an FRM file</a></li>
      <li><a href="#check-if-a-library-is-installed" id="markdown-toc-check-if-a-library-is-installed">Check if a library is installed</a></li>
      <li><a href="#fs-in-file" id="markdown-toc-fs-in-file">FS in File</a></li>
      <li><a href="#encrypt-tar-with-opensslgpg" id="markdown-toc-encrypt-tar-with-opensslgpg">Encrypt Tar with OpenSSL\GPG</a></li>
      <li><a href="#split-big-archive" id="markdown-toc-split-big-archive">Split big archive</a></li>
      <li><a href="#installed-pkgs-size" id="markdown-toc-installed-pkgs-size">Installed pkgs size</a></li>
      <li><a href="#compare-2-directory" id="markdown-toc-compare-2-directory">Compare 2 directory</a></li>
      <li><a href="#wget-all-site" id="markdown-toc-wget-all-site">WGet ALL site</a></li>
      <li><a href="#mount-with-ssh" id="markdown-toc-mount-with-ssh">Mount with SSH</a></li>
      <li><a href="#boot-in-dos" id="markdown-toc-boot-in-dos">Boot in DOS</a></li>
      <li><a href="#remove-all-tables-from-mysql-db" id="markdown-toc-remove-all-tables-from-mysql-db">Remove all tables from MySQL DB</a></li>
      <li><a href="#resize-jpg-for-web" id="markdown-toc-resize-jpg-for-web">Resize jpg for web</a></li>
      <li><a href="#postfix-redirect-outbound-mail" id="markdown-toc-postfix-redirect-outbound-mail">Postfix redirect outbound mail</a></li>
      <li><a href="#rm-argument-list-too-long" id="markdown-toc-rm-argument-list-too-long">RM: Argument list too long</a></li>
      <li><a href="#rootkits-check" id="markdown-toc-rootkits-check">Rootkits check</a></li>
      <li><a href="#restore-deleted-files" id="markdown-toc-restore-deleted-files">Restore deleted files</a></li>
      <li><a href="#flush-linux-disk-cache" id="markdown-toc-flush-linux-disk-cache">Flush linux disk cache</a></li>
    </ul>
  </li>
</ul>

  </div>
</section>
<!-- /#table-of-contents -->

<h3 id="other-parts">Other parts</h3>
<p><a href="https://jivoi.github.io/2014/06/22/linux-unix-it-tips-and-tricks-number-1/">Part 1</a>
<a href="https://jivoi.github.io/2015/06/29/linux-unix-it-tips-and-tricks-number-2/">Part 2</a></p>

<h3 id="speed-up-mysql-import">Speed up MySQL Import</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">mysql -u someuser -p SET <span class="nv">AUTOCOMMIT</span><span class="o">=</span>0<span class="p">;</span> SET <span class="nv">UNIQUE_CHECKS</span><span class="o">=</span>0<span class="p">;</span> SET <span class="nv">FOREIGN_KEY_CHECKS</span><span class="o">=</span>0<span class="p">;</span> <span class="se">\</span>
<span class="nb">source </span>dump.sql<span class="p">;</span>SET <span class="nv">FOREIGN_KEY_CHECKS</span><span class="o">=</span>1<span class="p">;</span> <span class="nv">UNIQUE_CHECKS</span><span class="o">=</span>1<span class="p">;</span> COMMIT<span class="p">;</span></code></pre></div>

<h3 id="coreutils-list">Coreutils List</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">curl <span class="s1">&#39;http://www.gnu.org/software/coreutils/manual/coreutils.html&#39;</span> 2&gt;/dev/null <span class="p">|</span>grep <span class="s1">&#39;h3 class&#39;</span> <span class="p">|</span> grep <span class="s1">&#39;class=&quot;command&quot;&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/.*class=&quot;command&quot;&gt;//&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s|&lt;/span&gt;&lt;/samp&gt;||&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s|&lt;/h3&gt;||&#39;</span> <span class="p">|</span> grep <span class="s1">&#39;:&#39;</span> <span class="p">|</span> sort</code></pre></div>

<h3 id="list-all-process-swap-space-usage">List all process swap space usage</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">for</span> file in /proc/*/status <span class="p">;</span> <span class="k">do</span> awk <span class="s1">&#39;/VmSwap|Name/{printf $2 &quot; &quot; $3}END{ print &quot;&quot;}&#39;</span> <span class="nv">$file</span><span class="p">;</span> <span class="k">done</span></code></pre></div>

<h3 id="delete-millions-files-from-dir">Delete millions files from dir</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># rm is fucked, this is ok =)</span>
perl -e <span class="s1">&#39;chdir &quot;/tmp/1&quot; or die; opendir D, &quot;.&quot;; while ($n = readdir D) { unlink $n }&#39;</span></code></pre></div>

<h3 id="nice-diff">Nice Diff</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">diff --side-by-side fileA.txt fileB.txt <span class="p">|</span> pager</code></pre></div>

<h3 id="run-jobs-with-parallel">Run jobs with parallel</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># apt-get install parallel</span>
ls *.png <span class="p">|</span> parallel -j4 convert <span class="o">{}</span> <span class="o">{</span>.<span class="o">}</span>.jpg</code></pre></div>

<h3 id="awk-ps-sum">Awk PS SUM</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">ps alx <span class="p">|</span> tail -n +2 <span class="p">|</span> awk <span class="s1">&#39;BEGIN{rss=0; vsz=0} {rss += $7; vsz+=$8} END{print rss, vsz;}&#39;</span></code></pre></div>

<h3 id="show-ext4-fragmentation-">Show ext4 fragmentation %</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># be carefull!!</span>
<span class="k">for</span> D in <span class="k">$(</span> mount <span class="p">|</span> awk <span class="s1">&#39;$5~/ext4/ { print $1 }&#39;</span> <span class="k">)</span><span class="p">;</span> <span class="k">do</span> sudo fsck.ext4 -nvf <span class="k">${</span><span class="nv">D</span><span class="k">}</span><span class="p">;</span> <span class="k">done</span>
non-contiguous is a % of fragmentation

e4defrag /
e4defrag -c /

<span class="c"># fragmentation for file</span>
filefrag -v /PATH/TO/FILE</code></pre></div>

<h3 id="statistic-of-system-resource">Statistic of system resource</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># apt-get install dstat</span>
dstat -c --top-cpu -d --top-bio --top-latency</code></pre></div>

<h3 id="tcpdump-with-ssh-stream">Tcpdump with SSH stream</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># stream through SSH the tcpdump output and analyze it locally with Wireshark</span>
mkfifo /tmp/wshark
ssh root@ip <span class="s2">&quot;tcpdump -s 0 -U -n -w - -i eth0 not port 22&quot;</span> &gt; /tmp/wshark
wireshark -k -i /tmp/wshark</code></pre></div>

<h3 id="linux-namespaces">Linux Namespaces</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">Starting from kernel 2.6.24, Linux supports <span class="m">6</span> different types of namespaces. Namespaces are useful in creating processes that are more isolated from the rest of the system, without needing to use full low level virtualization technology.

CLONE_NEWIPC: IPC Namespaces: SystemV IPC and POSIX Message Queues can be isolated.
CLONE_NEWPID: PID Namespaces: PIDs are isolated, meaning that a virtual PID inside of the namespace can conflict with a PID outside of the namespace. PIDs inside the namespace will be mapped to other PIDs outside of the namespace. The first PID inside the namespace will be ‘1’ which outside of the namespace is assigned to init
CLONE_NEWNET: Network Namespaces: Networking <span class="o">(</span>/proc/net, IPs, interfaces and routes<span class="o">)</span> are isolated. Services can be run on the same ports within namespaces, and “duplicate” virtual interfaces can be created.
CLONE_NEWNS: Mount Namespaces. We have the ability to isolate mount points as they appear to processes. Using mount namespaces, we can achieve similar functionality to chroot<span class="o">()</span> however with improved security.
CLONE_NEWUTS: UTS Namespaces. This namespaces primary purpose is to isolate the hostname and NIS name.
CLONE_NEWUSER: User Namespaces. Here, user and group IDs are different inside and outside of namespaces and can be duplicated.</code></pre></div>

<h3 id="show-daemon-list-need-to-restart-after-update">Show daemon list need to restart after update</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo lsof / <span class="p">|</span> grep DEL <span class="p">|</span> cut -f1 -d<span class="s1">&#39; &#39;</span> <span class="p">|</span> sort -u</code></pre></div>

<h3 id="increases-tcpdump-buffer">Increases TCPdump buffer</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">tcpdump -l -B <span class="m">10000</span> host example.com</code></pre></div>

<h3 id="get-firefox-bookmarks">Get Firefox bookmarks</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sqlite3 ~/.mozilla/firefox/*.<span class="o">[</span>dD<span class="o">]</span>efault/places.sqlite <span class="s2">&quot;SELECT strftime(&#39;%d.%m.%Y %H:%M:%S&#39;, dateAdded/1000000, &#39;unixepoch&#39;, &#39;localtime&#39;),url FROM moz_places, moz_bookmarks WHERE moz_places.id = moz_bookmarks.fk ORDER BY dateAdded;&quot;</span></code></pre></div>

<h2 id="ssl-certs-info">SSL certs info</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># show expire date of cert</span>
openssl x509 -enddate -noout -in certnew.cer
<span class="c"># show all info of cert</span>
openssl x509 -text -noout -in certnew.cer
<span class="c"># check that secret key (privkey.pem) is valid</span>
openssl rsa -noout -text -in privkey.pem</code></pre></div>

<h2 id="reset-root-password-on-rhel7centos7">Reset root password on RHEL7\CentOS7</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">grub linux16 to the end of the line add <span class="s2">&quot;rd.break  console=tty1&quot;</span>
ctrl+x
switch_root:/# mount -o remount,rw /sysroot
switch_root:/# chroot /sysroot
sh-4.2# passwd root
sh-4.2# touch /.autorelabel
<span class="nb">exit</span></code></pre></div>

<h3 id="blacklisting-firewire-in-linux">Blacklisting firewire in Linux</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">find /lib/modules/<span class="sb">`</span>uname -r<span class="sb">`</span> -name *firewire*
modinfo snd-firewire-lib
modinfo firewire-core
<span class="nb">echo</span> <span class="s2">&quot;blacklist firewire-core&quot;</span> &gt; /etc/modprobe.d/blacklist-firewire.conf
modprobe --showconfig <span class="p">|</span> grep blacklist <span class="c">#show blacklist modules</span>
modprobe --showconfig <span class="p">|</span> grep <span class="s2">&quot;^install&quot;</span> <span class="p">|</span> grep <span class="s2">&quot;/bin&quot;</span></code></pre></div>

<h3 id="install-ubuntu-openstack">Install Ubuntu OpenStack</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo apt-add-repository -y ppa:cloud-installer/stable
sudo apt-get update
sudo apt-get install -y openstack
sudo openstack-install</code></pre></div>

<h3 id="vagrant-winxp">Vagrant WinXP</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># https://www.bram.us/2014/09/24/modern-ie-vagrant-boxes/</span>
<span class="c"># http://aka.ms/vagrant-xp-ie6</span>
vagrant box add winxpie6 http://aka.ms/vagrant-xp-ie6
vagrant init winxpie6
vagrant up</code></pre></div>

<h3 id="simple-cut-video-in-linux">Simple Cut Video in linux</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># cut video from 00:02:52 to 00:03:45</span>
ffmpeg -i original.mp4 -ss 00:02:52 -t 00:03:45 -async <span class="m">1</span> -strict -2 cut.mp4</code></pre></div>

<h3 id="how-to-clean-tmp-dir-on-boot">How to clean TMP dir on boot</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">/etc/default/rcS
<span class="c">#TMPTIME=0</span></code></pre></div>

<h3 id="the-port-scan-attack-detector---psad">The port scan attack detector - PSAD</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># http://cipherdyne.org/psad/</span>
apt-get install psad

/etc/syslog.conf
kern.info       <span class="p">|</span>/var/lib/psad/psadfifo

/etc/init.d/sysklogd restart
/etc/init.d/klogd

/etc/psad/psad.conf
/etc/init.d/psad restart

iptables -A INPUT -j LOG
iptables -A FORWARD -j LOG

view port scan report
psad -S</code></pre></div>

<h3 id="snmptrap-using">SNMPTrap using</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">/etc/default/snmpd
<span class="nv">TRAPDRUN</span><span class="o">=</span>yes

/etc/snmp/snmptrapd.conf
authCommunity log public

snmptrap -v <span class="m">1</span> -c public 127.0.0.1 .1.3.6.1 localhost <span class="m">6</span> <span class="m">17</span> <span class="s1">&#39;&#39;</span> .1.3.6.1 s <span class="s2">&quot;Just a test&quot;</span>

/var/log/syslog
Jun <span class="m">23</span> 12:14:47 linux snmptrapd<span class="o">[</span>14221<span class="o">]</span>: 2015-06-23 12:14:47 linux <span class="o">[</span>127.0.0.1<span class="o">]</span> <span class="o">(</span>via UDP: <span class="o">[</span>127.0.0.1<span class="o">]</span>:58914-&gt;<span class="o">[</span>127.0.0.1<span class="o">])</span> TRAP, SNMP v1, community public#012#011iso.3.6.1 Enterprise Specific Trap <span class="o">(</span>17<span class="o">)</span> Uptime: <span class="m">1</span> day, 1:45:51.14#012#011iso.3.6.1 <span class="o">=</span> STRING: <span class="s2">&quot;Just a test&quot;</span>

<span class="c"># tcpdump snmptraps</span>
tcpdump -i eth1 -w test.log <span class="s2">&quot;udp and (src port 161 or 162)&quot;</span>
tcpdump -w troubleshoot.pcap -vv -A -T snmp <span class="err">&quot;</span><span class="o">(</span>dst port 162<span class="o">)</span> or <span class="o">(</span>src port 161<span class="o">)</span> or <span class="o">(</span>dst port 161<span class="o">)</span></code></pre></div>

<h3 id="remove-postfix-resiver-header">Remove Postfix Resiver Header</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># add to /etc/postfix/header_checks</span>
/^Received:.*with ESMTP/              IGNORE

<span class="c"># add to /etc/postfix/main.cf</span>
<span class="nv">mime_header_checks</span> <span class="o">=</span> regexp:/etc/postfix/header_checks <span class="nv">header_checks</span> <span class="o">=</span> regexp:/etc/postfix/header_checks
postmap /etc/postfix/header_checks
postfix reload</code></pre></div>

<h3 id="ssh-key-login-only-for-one-user">SSH key login only for one user</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># add to /etc/ssh/sshd_config</span>
Match user stew
PasswordAuthentication no

or

Match group dumbusers
PasswordAuthentication no</code></pre></div>

<h3 id="revert-firefox-to-init-state">Revert Firefox to init state</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">open about:support and press &lt;Refresh Firefox&gt;</code></pre></div>

<h3 id="limit-mysql-and-mongodb-mem-usage-with-cgroups">Limit MySQL and MongoDB mem usage with Cgroups</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">cgcreate -g memory:DBLimitedGroup
<span class="nb">echo </span>16G &gt; /sys/fs/cgroup/memory/DBLimitedGroup/memory.limit_in_bytes
sync<span class="p">;</span> <span class="nb">echo </span><span class="m">3</span> &gt; /proc/sys/vm/drop_caches
cgclassify -g memory:DBLimitedGroup <span class="sb">`</span>pidof mongod<span class="sb">`</span>
cgclassify -g memory:DBLimitedGroup <span class="sb">`</span>pidof mysqld_safe<span class="sb">`</span></code></pre></div>

<h3 id="strace-using">Strace using</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># file activity common syscalls:</span>
access <span class="o">()</span>
close <span class="o">(</span>close file handle<span class="o">)</span>
fchmod <span class="o">(</span>change file permissions<span class="o">)</span>
fchown <span class="o">(</span>change file ownership<span class="o">)</span>
fstat <span class="o">(</span>retrieve details<span class="o">)</span>
lseek <span class="o">(</span>move through file<span class="o">)</span>
open <span class="o">(</span>open file <span class="k">for</span> reading/writing<span class="o">)</span>
<span class="nb">read</span> <span class="o">(</span><span class="nb">read </span>a piece of data<span class="o">)</span>
statfs <span class="o">(</span>retrieve file system related details<span class="o">)</span>

<span class="nv">$ </span>strace php 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep php.ini
<span class="nv">$ </span>strace -e open php 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep php.ini
<span class="nv">$ </span>strace -e open,access 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep your-filename
<span class="nv">$ </span>strace -p PID
<span class="c"># strace -c -p PID</span>

<span class="c"># the network common syscalls:</span>
<span class="nb">bind</span> – link the process to a network port
listen – allow to receive incoming connections
socket – open a <span class="nb">local </span>or network socket
setsockopt – define options <span class="k">for</span> an active socket

<span class="nv">$ </span>strace -e poll,select,connect,recvfrom,sendto nc www.news.com 80
<span class="nv">$ </span>strace -e <span class="nv">trace</span><span class="o">=</span>network

<span class="c"># memory common syscalls:</span>
mmap
munmap

<span class="nv">$ </span>strace -e <span class="nv">trace</span><span class="o">=</span>memory

<span class="c"># useful options and examples:</span>
-c – See what <span class="nb">time </span>is spend and where <span class="o">(</span>combine with -S <span class="k">for</span> sorting<span class="o">)</span>
-f – Track process including forked child processes
-o my-process-trace.txt – Log strace output to a file
-p <span class="m">1234</span> – Track a process by PID
-P /tmp – Track a process when interacting with a path
-T – Display syscall duration in the output

<span class="c"># track by specific syscall group:</span>
-e <span class="nv">trace</span><span class="o">=</span>ipc – Track communication between processes <span class="o">(</span>IPC<span class="o">)</span>
-e <span class="nv">trace</span><span class="o">=</span>memory – Track memory syscalls
-e <span class="nv">trace</span><span class="o">=</span>network – Track memory syscalls
-e <span class="nv">trace</span><span class="o">=</span>process – Track process calls <span class="o">(</span>like fork, <span class="nb">exec</span><span class="o">)</span>
-e <span class="nv">trace</span><span class="o">=</span>signal – Track process signal handling <span class="o">(</span>like HUP, <span class="nb">exit</span><span class="o">)</span>
-e <span class="nv">trace</span><span class="o">=</span>file – Track file related syscalls

<span class="c"># trace multiple syscalls:</span>
strace -e open,close</code></pre></div>

<h3 id="linux-system-errors-types">Linux System Errors Types</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">cat /usr/include/asm-generic/errno.h <span class="p">|</span>grep <span class="s2">&quot;#&quot;</span></code></pre></div>

<h3 id="auditd">Auditd</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># create rule: open</span>
auditctl -a always,exit -F <span class="nv">arch</span><span class="o">=</span>b64 -F <span class="nv">pid</span><span class="o">=</span><span class="m">8175</span> -S open -k cups-open-files
ausearch -k cups-open-files

<span class="c"># check which process is modifying a certain directory or file</span>
auditctl -w /path/to/directory -p war
ausearch -f /path/to/directory</code></pre></div>

<h3 id="mysql-version-from-an-frm-file">MySQL version from an FRM file</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># MySQL version 5.5.32</span>
<span class="nv">$ </span>hexdump -s 0x33 -n <span class="m">2</span> -v -d 55_test.frm
<span class="m">0000033</span> 50532
<span class="c"># MySQL version 5.1.73</span>
<span class="nv">$ </span>hexdump -s 0x33 -n <span class="m">2</span> -v -d 51_test.frm
<span class="m">0000033</span> 50173</code></pre></div>

<h3 id="check-if-a-library-is-installed">Check if a library is installed</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>ldconfig -p <span class="p">|</span> grep libjpeg</code></pre></div>

<h3 id="fs-in-file">FS in File</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/tmp/disk-image <span class="nv">count</span><span class="o">=</span>20480
<span class="nv">$ </span>mkfs -t ext4 -q /tmp/disk-image
<span class="nv">$ </span>mkdir /virtual-fs
<span class="nv">$ </span>mount -o <span class="nv">loop</span><span class="o">=</span>/dev/loop0 /tmp/disk-image /virtual-fs
<span class="c"># add to /etc/fstab</span>
/tmp/disk-image /virtual-fs ext4 rw,loop <span class="m">0</span> 0</code></pre></div>

<h3 id="encrypt-tar-with-opensslgpg">Encrypt Tar with OpenSSL\GPG</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># encrypt</span>
<span class="nv">$ </span>gpg -c test.tar
<span class="nv">$ </span>tar -czv stuff<span class="p">|</span>openssl des3 -salt -k secretpassword <span class="p">|</span> dd <span class="nv">of</span><span class="o">=</span>stuff.des3
<span class="c"># decrypt</span>
<span class="nv">$ </span>gpg test.tar.gpg
<span class="nv">$ </span>dd <span class="k">if</span><span class="o">=</span>stuff.des3 <span class="p">|</span>openssl des3 -d -k secretpassword<span class="p">|</span>tar xz</code></pre></div>

<h3 id="split-big-archive">Split big archive</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">split -b 700m archive.tar part
cat part* &gt; archive.tar</code></pre></div>

<h3 id="installed-pkgs-size">Installed pkgs size</h3>
<p># freebsd</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">pkg_info -as <span class="p">|</span> perl -pe <span class="s1">&#39;$/=&quot;)&quot;; s/\n*Information for (.*?):[\n\s]*Package Size:[\n\s]*(\d+)\s*\(\s*1K\-blocks\s*\)/$2 - $1\n/;&#39;</span> <span class="p">|</span> sort -nr <span class="p">|</span> less

<span class="c"># ubuntu</span>
dpkg-query -W --showformat<span class="o">=</span><span class="s1">&#39;${Installed-Size} ${Package}\n&#39;</span> <span class="p">|</span> sort -n</code></pre></div>

<h3 id="compare-2-directory">Compare 2 directory</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">diff -qr dir1 dir2</code></pre></div>

<h3 id="wget-all-site">WGet ALL site</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">wget -m -k -nv -np -p --user-agent<span class="o">=</span><span class="s2">&quot;Mozilla/5.0 (compatible; Konqueror/3.0.0/10; Linux)&quot;</span> http://www.rhd.ru/docs/manuals/enterprise/RHEL-5-Manual/Virtual-Server-Administration/</code></pre></div>

<h3 id="mount-with-ssh">Mount with SSH</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">apt-get install sshfs
mkdir ~/music
sshfs &lt;remote_ip&gt;:/music ~/music/
fusermount -u ~/music/</code></pre></div>

<h3 id="boot-in-dos">Boot in DOS</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">apt-get install syslinux
cp /usr/share/syslinux/memdisk /boot
wget -O /boot/Dos6.22.img http://www.allbootdisks.com/downloads/Disks/MS-DOS_Boot_Disk_Download47/Diskette%20Images/Dos6.22.img
<span class="c"># add to /boot/grub/menu.lst</span>
title MSDOS
root<span class="o">(</span>hd0,0<span class="o">)</span> <span class="c"># Номер диска изменить на нужный</span>
kernel /memdisk
initrd /Dos6.22.img</code></pre></div>

<h3 id="remove-all-tables-from-mysql-db">Remove all tables from MySQL DB</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">mysql -u root -ppassword -Ddb-name -e <span class="s1">&#39;show tables;&#39;</span> <span class="p">|</span> grep -v <span class="s1">&#39;Tables_in&#39;</span> &gt; /tmp/tables_list
<span class="k">for</span> table in <span class="sb">`</span>cat /tmp/tables_list<span class="sb">`</span><span class="p">;</span> <span class="k">do</span> mysql -u root -ppassword -Ddb-name -e <span class="s2">&quot;drop table $table;&quot;</span> <span class="p">;</span> <span class="k">done</span></code></pre></div>

<h3 id="resize-jpg-for-web">Resize jpg for web</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">for</span> i in *.jpg<span class="p">;</span> <span class="k">do</span> convert -resize 640x480 -quality <span class="m">85</span> <span class="nv">$i</span> small-<span class="nv">$i</span>.jpg<span class="p">;</span> <span class="k">done</span></code></pre></div>

<h3 id="postfix-redirect-outbound-mail">Postfix redirect outbound mail</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># all outbound mail redirect to local &lt;username&gt;</span>
<span class="nv">$ </span>postconf -e <span class="nv">luser_relay</span><span class="o">=</span>username
<span class="nv">$ </span>postmap /etc/postfix/transport
<span class="nv">$ </span>postconf -e <span class="nv">transport_maps</span><span class="o">=</span><span class="nb">hash</span>:/etc/postfix/transport
<span class="c"># add to /etc/postfix/transport</span>
localhost :
* <span class="nb">local</span>:username</code></pre></div>

<h3 id="rm-argument-list-too-long">RM: Argument list too long</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">find <span class="p">|</span> xargs --no-run-if-empty -n <span class="m">500</span> rm -f</code></pre></div>

<h3 id="rootkits-check">Rootkits check</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">apt-get install rkhunter
rkhunter –-update
rkhunter –-check</code></pre></div>

<h3 id="restore-deleted-files">Restore deleted files</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">lsof <span class="p">|</span> grep storage.db
memcached <span class="m">22073</span> memcachedb   15u      REG                8,1 <span class="m">88090279936</span>   <span class="m">14221332</span> /path/memcachedb/storage.db <span class="o">(</span>deleted<span class="o">)</span>
/proc/22073/fd
find /path/memcachedb/ -inum <span class="m">14221332</span> -exec cp <span class="o">{}</span> /var/tmp/storage.db <span class="se">\;</span></code></pre></div>

<h3 id="flush-linux-disk-cache">Flush linux disk cache</h3>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo sh -c <span class="s1">&#39;sync; echo 3 &gt; /proc/sys/vm/drop_caches&#39;</span></code></pre></div>


      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          



	<img src="https://jivoi.github.io/images/avatar.jpg" class="bio-photo" alt="EK bio photo">

<h3>EK</h3>
<p>I'm a hacker and security researcher</p>
<a href="mailto:ekoz@protonmail.com" class="author-widgets" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
<a href="http://twitter.com/jivoi" class="author-widgets" target="_blank"><i class="fa fa-fw fa-tw-square"></i> Twitter</a>





<a href="http://github.com/jivoi" class="author-widgets" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>










        </div>
        <p class="byline"><strong> Linux-Unix-IT Tips and Tricks #3</strong> was published on <time datetime="2015-07-01T00:00:00+03:00">July 01, 2015</time> and last modified on <time datetime="2015-07-01">July 01, 2015</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="https://jivoi.github.io/archive/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="https://jivoi.github.io/2015/07/07/playing-with-devstack/" title="Playing with DevStack">Playing with DevStack</a></li>
    
      <li><a href="https://jivoi.github.io/2015/07/04/otkrytyie-bazy-dannykh-rf/" title="Открытые базы данных РФ">Открытые базы данных РФ</a></li>
    
      <li><a href="https://jivoi.github.io/2015/07/03/playing-with-sysdig/" title="Playing with Sysdig">Playing with Sysdig</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://jivoi.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://jivoi.github.io/assets/js/scripts.min.js"></script>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=2435245; 
var sc_invisible=1; 
var sc_security="015e0a49"; 
</script>
<script type="text/javascript" src="http://www.statcounter.com/counter/counter.js"></script>
<noscript><div class="statcounter"><a title="free hitcounter" href="http://statcounter.com/" target="_blank"><img class="statcounter" src="http://c.statcounter.com/2435245/0/015e0a49/1/" alt="free hit counter"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-64125092-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'httpjivoigithubcom'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


	        

</body>
</html>
